<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kamus Kanji ‚Äî JLPT (Indonesia)</title>
  <script src="https://unpkg.com/feather-icons"></script>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;700&display=swap" rel="stylesheet">
  <style>
  :root {
    --bg:#0b0b0c; --panel:#121214; --muted:#9aa3b2; --accent:#701212;
    --n5:#1e2b1d; --n4:#23302e; --n3:#29281f; --n2:#24201c; --n1:#271d1d;
    --wn5:#209717; --wn4:#1eaa95; --wn3:#bbab19; --wn2:#be6a16; --wn1:#c71919;
    font-family:'Noto Sans JP',system-ui,-apple-system,'Segoe UI',Roboto,Arial;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:#eef2f6;-webkit-font-smoothing:antialiased}
  .app{max-width:1180px;margin:18px auto;padding:18px}
  header{display:flex;gap:12px;align-items:center;justify-content:space-between}
  .brand{display:flex;gap:12px;align-items:center}
  h1{margin:0;font-size:18px}
  .controls{display:flex;gap:8px;align-items:center}
  input[type="search"], select, button{
    background:#0f1113;border:1px solid #301b1b;padding:10px 12px;border-radius:0px 10px;
    color:#e3e8ef;font-size:14px;transition:all .2s ease;
  }
  .rad {
  display: inline-block;
  margin: 4px;
  padding: 6px 10px;
  border-radius: 8px;
  background: #222;
  color: #fff;
  font-size: 22px;
  font-weight: 700;
  box-shadow: 0 0 6px rgba(255,255,255,0.3);
}
.rad.main {
  background: #333;
  box-shadow: 0 0 10px rgba(255,255,255,0.6);
}
.muted {
  color: #888;
  font-size: 18px;
}

  input::placeholder{color:#6b7280}
  select{appearance:none;-webkit-appearance:none;cursor:pointer;position:relative;padding-right:28px;}
  select:hover,button:hover,input[type="search"]:hover{
    box-shadow:0 0 0 2px #d61212;
  }
  button{cursor:pointer}
  button:hover{background:var(--accent);border:4px #d61212;color:white}
  .main{display:grid;grid-template-columns:410px 1fr;gap:20px;margin-top:18px}
  .panel{background:var(--panel);border-radius:14px;padding:16px;box-shadow:0 8px 30px rgba(0,0,0,0.6)}
  
  /* --- KANJI GRID --- */
  .list-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
  .kanji-grid{
    display:grid;grid-template-columns:repeat(5,1fr);gap:10px;
    height:80vh;overflow:auto;padding-right:6px;
  }
  .kanji-card{
    border-radius:0px 10px;padding:10px;
    display:flex;flex-direction:column;align-items:center;justify-content:center;
    cursor:pointer;
    border:1px solid #272b30;
    transition:transform .18s, box-shadow .18s, filter .18s;
    color:#fff;font-weight:600;text-shadow:0 1px 2px rgba(0,0,0,.3);
  }
  .kanji-card:hover{
    transform:translateY(-6px) scale(1.05);
    box-shadow:0 0 10px rgba(40, 217, 179, 0.4);
    filter:brightness(1.1);
  }
  .kanji-char{font-size:30px}
  .kanji-meaning{font-size:12px;color:var(--muted);margin-top:6px;text-align:center}
  
  /* --- DETAIL PANEL --- */
  .detail-grid{display:grid;grid-template-columns:320px 1fr;gap:18px}
  .kanji-large{
    background:#0a0a0b;border-radius:12px;padding:26px;
    display:flex;align-items:center;justify-content:center;
    font-size:120px;min-height:220px;
  }
  .meta-box{display:flex;flex-direction:column;gap:10px}
  .title-row{display:flex;align-items:center;gap:12px}
  .title-row h2{margin:0}
  .badge{padding:6px 10px;border-radius:10px;font-weight:700;font-size:13px;color:#08101a}
  .badge.jlpt{color:white}
  .muted{color:var(--muted)}
  .radicals{display:flex;gap:8px;flex-wrap:wrap}
  .rad{background:#0f1417;padding:6px 8px;border-radius:8px;border:1px solid #233;min-width:36px;text-align:center}
  .words{margin-top:8px}
  .word{padding:10px;border-radius:8px;background:#181818;margin-bottom:8px}
  .loading{opacity:.85;font-style:italic}
  footer{margin-top:14px;color:var(--muted);font-size:13px}
  
  /* --- RESPONSIVE --- */
  @media (max-width:980px){
    .main{grid-template-columns:1fr}
    .kanji-grid{grid-template-columns:repeat(6,1fr);height:25vh;}
    .kanji-large{font-size:72px;min-height:160px;padding:16px}
    .detail-grid{grid-template-columns:1fr}
  }
  @media (max-width:480px){
    .kanji-grid{grid-template-columns:repeat(4,1fr);height:25vh;}
    input[type="search"]{min-width:140px}
  }

  .censorable {
    transition: filter 0.4s ease, opacity 0.4s ease;
  }

  /* when censored */
  .censored {
    filter: blur(6px);
    opacity: 0.4;
    user-select: none;
  }

  .censorable1 {
    transition: filter 0.4s ease, opacity 0.4s ease;
  }

  /* when censored */
  .censored1 {
    filter: blur(50px);
    opacity: 0.4;
    user-select: none;
  }

</style>


</head>
<body>
  <div class="app">
    <header>
      <div class="brand">
        <h1>Kamus Kanji ‚Äî JLPT</h1>
        <div class="muted">Klik kanji untuk melihat detail (arti otomatis ke Bahasa Indonesia)</div>
      </div>
    </header><br>
    <section class="panel">
    <div class="meta-box">
        <input id="searchInput" type="search" style="height: 50px;" placeholder="Cari kanji (ketik lalu Enter)" />
        <div style="display: flex;flex-direction: row;justify-content: space-between; flex-grow: 1;">
        <select id="listSelect" aria-label="Pilih level" style="flex-grow: 1; margin-right: 20px;">
          <option value="hiragana">Hiragana</option>
          <option value="katakana">Katakana</option>
          <option value="jlpt-n5">üü© JLPT N5</option>
          <option value="jlpt-n4">üü¶ JLPT N4</option>
          <option value="jlpt-n3">üü® JLPT N3</option>
          <option value="jlpt-n2">üüß JLPT N2</option>
          <option value="jlpt-n1">üü• JLPT N1</option>
        </select>
        <button id="loadList">Muat</button></div>
      </div>
      </section>

    <div class="main">
      <aside class="panel">
        <div class="list-head">
          <strong>Daftar Kanji</strong>
          <div style="display:flex;gap:8px;align-items:center">

          </div>
        </div>
        <div id="kanjiGrid" class="kanji-grid" aria-live="polite"></div>
      </aside>

      <section class="panel">
        <div class="detail-grid">
          <div>
            <div style="margin-top:12px;margin-bottom: 12px;display:flex;gap:8px;height:44px;align-items:center">
              <div style="font-weight:700">Sensor</div> 
              <button id="toggleCensor">OFF</button>
              <button id="randomBtn">Kanji Acak</button>
              <button id="replayStroke">üîÅ Replay</button>
            </div>
            <div id="kanjiLarge" class="kanji-large">Êó•</div>
            <div style="margin-top:12px;display:flex;gap:8px;height:44px;align-items:center">
              <div id="strokeBadge" class="badge" style="background:#111;color:var(--muted)">Goresan: -</div>
              <div id="jlptBadge" class="badge jlpt" style="background:var(--n5)">JLPT N5</div>
            </div>
            <div id="strokeBox" class="panel censorable1" style="margin-top:10px;"></div>
          

          </div>

          <div>
            <div class="meta-box">
              <div class="title-row">
                <h2 id="kanjiTitle">Êó•</h2>
                <div id="readingLine" class="muted"></div>
              </div>

              <div>
                <div style="font-weight:700">Arti (English)</div>
                <div id="meaningsEng" class="muted loading censorable">-</div>
              </div>

              <div>
                <div style="font-weight:700">Arti (Indonesia)</div>
                <div id="meaningsId" class="muted loading censorable">-</div>
              </div>
                <div>
                  <div style="font-weight:700">Bacaan Kun'yomi</div>
                  <div id="kunRead" class="muted censorable">-</div>
                </div>
                <div>
                  <div style="font-weight:700">Bacaan On'yomi</div>
                  <div id="onRead" class="muted censorable">-</div>
                </div>

                <div>
                <div style="font-weight:700">Dapat Dibaca Sebagai</div>
                <div id="romaread" class="muted loading censorable">-</div>
              </div>

              <div>
                <div style="font-weight:700">Kata umum</div>
                <div id="wordsList" class="words censorable"><div class="muted">-</div></div>
              </div>

            </div>
          </div>
        </div>

        <footer>Data detail dari <a href="https://kanjiapi.dev" style="color:var(--accent)">kanjiapi.dev</a>. Terjemahan oleh MyMemory (gratis).</footer>
      </section>
    </div>
  </div>

  <script>
    
 const API_ROOT = 'https://kanjiapi.dev/v1';
 const MYMEMORY_BASE = 'https://api.mymemory.translated.net/get?q=';
 const LANG_PAIR = '&langpair=en|id';
 feather.replace();
 
 // --- 1. GLOBAL STATE FOR REPLAY ---
 let currentKanji = 'Êó•'; // Initialize with a default kanji
 
 const JLPT = {
  "hiragana": ("„ÅÇ„ÅÑ„ÅÜ„Åà„Åä„Åã„Åç„Åè„Åë„Åì„Åï„Åó„Åô„Åõ„Åù„Åü„Å°„Å§„Å¶„Å®„Å™„Å´„Å¨„Å≠„ÅÆ„ÅØ„Å≤„Åµ„Å∏„Åª„Åæ„Åø„ÇÄ„ÇÅ„ÇÇ„ÇÑ„ÇÜ„Çà„Çâ„Çä„Çã„Çå„Çç„Çè„Çí„Çì").split(""),
  "katakana": ("„Ç¢„Ç§„Ç¶„Ç®„Ç™„Ç´„Ç≠„ÇØ„Ç±„Ç≥„Çµ„Ç∑„Çπ„Çª„ÇΩ„Çø„ÉÅ„ÉÑ„ÉÜ„Éà„Éä„Éã„Éå„Éç„Éé„Éè„Éí„Éï„Éò„Éõ„Éû„Éü„É†„É°„É¢„É§„É¶„É®„É©„É™„É´„É¨„É≠„ÉØ„É≤„É≥").split(""),
  "jlpt-n5": ("‰∏Ä‰∏É‰∏á‰∏â‰∏ä‰∏ã‰∏≠‰πù‰∫å‰∫î‰∫∫‰ªä‰ºë‰ΩïÂÖàÂÖ•ÂÖ´ÂÖ≠ÂÜÜÂá∫ÂâçÂåóÂçÅÂçÉÂçàÂçäÂçóÂèãÂè≥ÂêçÂõõÂõΩÂúüÂ§ñÂ§ßÂ§©Â•≥Â≠êÂ≠¶Â∞èÂ±±Â∑ùÂ∑¶Âπ¥ÂæåÊó•ÊôÇÊõ∏ÊúàÊú®Êú¨Êù•Êù±Ê†°ÊØçÊØéÊ∞óÊ∞¥ÁÅ´Áà∂ÁîüÁî∑ÁôΩÁôæËÅûË°åË•øË¶ãË©±Ë™ûË™≠ËªäÈáëÈï∑ÈñìÈõ®ÈõªÈ£üÈ´ò").split(""), 
  "jlpt-n4": ("‰∏ç‰∏ñ‰∏ª‰∫ã‰ª∂‰∫¨‰ªï‰ª£‰ª•‰ºö‰Ωè‰Ωì‰Ωú‰ΩøÂÄüÂÖÉÂÖÑÂÖ¨ÂÜôÂÜ¨ÂàáÂà•ÂäõÂãâÂãïÂåªÂéªÂè£Âè§Âè∞ÂêåÂë≥ÂìÅÂì°ÂïèÂõ≥Âú∞Â†ÇÂ†¥ÊâÄÂ£≤Â§èÂ§ïÂ§öÂ§úÂ¶πÂßâÂßãÂ≠óÂÆâÂÆ§ÂÆ∂Â∞ëÂ±ãÂ∑•Â∏∞Â∫ÉÂ∫óÂ∫¶Âª∫ÂºüÂº∑ÂæÖÂøÉÊÄùÊÄ•ÊÇ™ÊÑèÊâãÊåÅÊïôÊñáÊñôÊñ∞ÊñπÊóÖÊóèÊó©ÊòéÊò†Êò•ÊòºÊõúÊúâÊúçÊúùÊ•≠Ê•ΩÊ≠åÊ≠¢Ê≠£Ê≠©Ê≠ªÊ≥®Ê¥ãÊµ∑Êº¢ÁâõÁâ©ÁâπÁä¨ÁêÜÁî®Áî∞Áî∫ÁîªÁïåÁóÖÁô∫ÁõÆÁúüÁùÄÁü•Á†îÁ§æÁßÅÁßãÁ©∂Á©∫Á´ãÁ≠îÁ¥ôÁµÇÁøíËÄÉËÄÖËÇâËá™Ëâ≤Ëä±Ëã±Ëå∂Ë¶™Ë®ÄË®àË©¶Ë≤∑Ë≤∏Ë≥™Ëµ§Ëµ∞Ëµ∑Ë∂≥Ëª¢ËøëÈÄÅÈÄöÈÄ±ÈÅãÈÅìÈáçÈáéÈäÄÈñãÈô¢ÈõÜÈùíÈü≥È°åÈ¢®È£ØÈ£≤È§®ÈßÖÈ®ìÈ≠öÈ≥•Èªí").split(""), 
  "jlpt-n3": ("‰∏é‰∏°‰πó‰∫à‰∫â‰∫í‰∫°‰∫§‰ªñ‰ªò‰ª∂‰ªª‰ºù‰ºº‰Ωç‰Ωô‰æã‰æõ‰æø‰øÇ‰ø°ÂÄíÂÄôÂÄ§ÂÅâÂÅ¥ÂÅ∂ÂÇôÂÉçÂÑ™ÂÖâÂÖ®ÂÖ±ÂÖ∑ÂÜÖÂÜ∑Âá¶ÂàóÂàùÂà§Âà©Âà∞Âà∂ÂàªÂâ≤Âä†Âä©Âä™Âä¥ÂãôÂãùÂã§ÂåñÂçòÂç±ÂéüÂèÇÂèçÂèéÂèñÂèóÂè∑ÂêàÂêëÂêõÂê¶Âê∏ÂêπÂëäÂëºÂëΩÂíåÂïÜÂñúÂõûÂõ†Âõ∞ÂúíÂú®Â†±Â¢óÂ£∞Â§âÂ§¢Â§™Â§´Â§±Â•ΩÂ¶ªÂ®òÂ©öÂ©¶Â≠òÂÆÖÂÆàÂÆåÂÆòÂÆöÂÆüÂÆ¢ÂÆ≥ÂÆπÂÆøÂØÑÂØåÂØíÂØùÂØüÂØæÂ±ÄÂ±ÖÂ∑ÆÂ∏ÇÂ∏´Â∏≠Â∏∏Âπ≥Âπ∏ÂπæÂ∫ßÂ∫≠ÂºèÂºïÂΩìÂΩ¢ÂΩπÂΩºÂæíÂæóÂæ°ÂøÖÂøòÂøôÂøµÊÄíÊÄñÊÄßÊÅêÊÅ•ÊÅØÊÇ≤ÊÉÖÊÉ≥ÊÑõÊÑüÊÖ£ÊàêÊà¶ÊàªÊâÄÊâçÊâìÊâïÊäïÊäòÊäúÊä±ÊäºÊãõÊåáÊçïÊéõÊé¢ÊîØÊîæÊîøÊïóÊï£Êï∞Êñ≠ÊòìÊòîÊò®Êô©ÊôØÊô¥ÊöóÊöÆÊõ≤Êõ¥ÊúÄÊúõÊúüÊú™Êú´ÊùüÊùØÊûúÊ†ºÊßãÊßòÊ®©Ê®™Ê©üÊ¨†Ê¨°Ê¨≤Ê≠ØÊ≠≥ÊÆãÊÆµÊÆ∫Ê∞ëÊ±ÇÊ±∫Ê≤ªÊ≥ïÊ≥≥Ê¥óÊ¥ªÊµÅÊµÆÊ∂àÊ∑±Ê∏àÊ∏°Ê∏ØÊ∫ÄÊºîÁÇπÁÑ∂ÁÖôÁÜ±ÁäØÁä∂Áå´ÁéãÁèæÁêÉÁî£Áî±Áî≥ÁïôÁï™ÁñëÁñ≤ÁóõÁôªÁöÜÁõóÁõ¥Áõ∏Áú†Áü≥Á†¥Á¢∫Á§∫Á§ºÁ•ñÁ•ûÁ¶èÁßëÁ®ãÁ®ÆÁ©çÁ™ÅÁ™ìÁ¨ëÁ≠âÁÆ±Á±≥Á≤æÁ¥ÑÁµÑÁµåÁµ¶ÁµµÁµ∂Á∂öÁ∑íÁΩ™ÁΩÆÁæéËÄÅËÄ≥ËÅ∑ËÇ≤ËÉåËÉΩËÖπËàûËàπËâØËã•Ëã¶ËçâËêΩËëâËñ¨Ë°ìË°®Ë¶ÅË¶èË¶öË¶≥Ëß£Ë®òË®™Ë®±Ë™çË™§Ë™¨Ë™øË´áË´ñË≠òË≠¶Ë≠∞Ë≤†Ë≤°Ë≤ßË≤¨Ë≤ªË≥áË≥õË∂äË∑ØËæûËæºËøéËøîËø∑ËøΩÈÄÄÈÄÉÈÄîÈÄüÈÄ£ÈÄ≤ÈÅÖÈÅäÈÅéÈÅîÈÅïÈÅ†ÈÅ©ÈÅ∏ÈÉ®ÈÉΩÈÖçÈÖíÈñâÈñ¢ÈôçÈôêÈô§Èô∫ÈôΩÈöõÈõëÈõ£Èõ™ÈùôÈùûÈù¢Èù¥È†ÇÈ†≠È†ºÈ°îÈ°òÈ°ûÈ£õÈ¶ñÈ¶¨È´™È≥¥").split(""), 
  "jlpt-n2": ("‰∏¶‰∏∏‰πÖ‰π±‰π≥‰πæ‰∫Ü‰ªã‰ªè‰ª§‰ª≤‰º∏‰º∫‰Ωé‰æùÂÄãÂÄçÂÅúÂÇæÂÉèÂÑÑÂÖÜÂÖêÂÖöÂÖµÂÜäÂÜçÂáçÂàäÂà∑Âà∏Âà∫ÂâáÂâØÂäáÂäπÂãáÂãüÂã¢ÂåÖÂåπÂå∫ÂçíÂçîÂç†Âç∞ÂçµÂéöÂèåÂè´Âè¨Âè≤ÂêÑÂê´Âë®Âí≤Âñ´Âñ∂Âõ£Âõ≤Âõ∫ÂúßÂùÇÂùáÂûãÂüãÂüéÂüüÂ°îÂ°óÂ°©Â¢ÉÂ§ÆÂ••ÂßìÂßîÂ≠£Â≠´ÂÆáÂÆùÂØ∫Â∞ÅÂ∞ÇÂ∞ÜÂ∞äÂ∞éÂ±äÂ±§Â≤©Â≤∏Â≥∂Â∑ûÂ∑®Â∑ªÂ∏ÉÂ∏åÂ∏ØÂ∏ΩÂπÖÂπ≤ÂπºÂ∫ÅÂ∫äÂ∫ïÂ∫úÂ∫´Âª∂Âº±ÂæãÂæ©Âø´ÊÅãÊÇ£ÊÇ©ÊÜéÊà∏ÊâøÊäÄÊãÖÊãùÊãæÊåüÊçúÊç®ÊéÉÊéòÊé°Êé•ÊèõÊêçÊîπÊï¨ÊóßÊòáÊòüÊôÆÊö¥ÊõáÊõøÊú≠Êú∫ÊùêÊùëÊùøÊûóÊûöÊûùÊûØÊüîÊü±ÊüªÊ†ÑÊ†πÊ¢∞Ê£íÊ£ÆÊ§çÊ•µÊ©ãÊ¨ßÊ≠¶Ê≠¥ÊÆøÊØíÊØîÊØõÊ∞∑Ê∞∏Ê±óÊ±öÊ±†Ê≤àÊ≤≥Ê≤∏Ê≤πÊ≥ÅÊ≥âÊ≥äÊ≥¢Ê≥•ÊµÖÊµ¥Ê∂ôÊ∂≤Ê∂ºÊ∑∑Ê∏ÖÊ∏õÊ∏©Ê∏¨ÊπñÊπØÊπæÊπøÊ∫ñÊ∫∂Êª¥ÊºÅÊøÉÊøØÁÅØÁÅ∞ÁÇ≠ÁÑºÁÖßÁáÉÁá•ÁàÜÁâáÁâàÁéâÁèçÁì∂ÁîòÁïúÁï•Áï≥ÁôÇÁöÆÁöøÁúÅÁúåÁü≠Á†ÇÁ°¨Á£®Á•àÁ•ùÁ•≠Á¶ÅÁßíÁßªÁ®éÁ´†Á´•Á´∂Á´πÁ¨¶Á≠ÜÁ≠íÁÆóÁÆ°ÁØâÁ∞°Á±çÁ≤âÁ≤íÁ≥∏Á¥ÖÁ¥îÁ¥∞Á¥πÁµ°Á∂øÁ∑èÁ∑ëÁ∑öÁ∑®Á∑¥Á∏æÁº∂ÁΩ≤Áæ§ÁæΩÁøåËÄïËÇåËÇ©ËÇØËÉÉËÉ∏ËÑÇËÑ≥ËÖïËÖ∞ËÜöËáìËá£ËàüËà™Ëà¨Ëä∏ËçíËç∑ËèìËèúËëóËí∏ËîµËñÑËô´Ë°ÄË°£Ë¢ãË¢´Ë£ÖË£èË£úË§áËßíËß¶Ë®ìË®≠Ë©ûË©∞Ë™åË™≤Ë´∏Ë¨õË∞∑Ë±äË±°Ë≤ùË≤®Ë≤©Ë≤ØË≤øË≥ûË≥¢Ë¥àË∂ÖË∑°Ë∏äËªçËªíËªüËªΩËº™Ëº∏ËæõËæ≤Ëæ∫Ëø∞ÈÄÜÈÄ†ÈÉäÈÉµÈáèÈáùÈàçÈâÑÈâ±ÈäÖÈã≠Èå≤ÈñÄÈò≤Èô∏ÈöÖÈöéÈöªÈõáÈõ≤Èõ∂ÈúáÈù©È†ÜÈ†êÈ†òÈ°çÈ¶ôÈßêÈ™®È∫¶ÈªÑÈºªÈΩ¢").split(""), 
  "jlpt-n1": ("‰∏Å‰∏ë‰∏î‰∏ò‰∏ô‰∏û‰∏π‰πÉ‰πã‰πè‰πô‰πü‰∫Ä‰∫ï‰∫ò‰∫ú‰∫•‰∫¶‰∫®‰∫´‰∫≠‰∫Æ‰ªÅ‰ªô‰ªÆ‰ª∞‰ºÅ‰ºä‰ºç‰ºé‰ºè‰ºê‰ºØ‰º¥‰º∂‰ºΩ‰ΩÜ‰Ωê‰Ωë‰Ω≥‰Ωµ‰æÉ‰æç‰æë‰æ°‰æÆ‰æØ‰æµ‰øÉ‰øä‰øó‰øù‰øÆ‰ø≥‰øµ‰ø∏ÂÄâÂÄñÂÄ£ÂÄ´ÂÄ≠ÂÄπÂÅèÂÅ•ÂÅ≤ÂÅµÂÅΩÂÇçÂÇëÂÇòÂÇ¨ÂÇµÂÇ∑ÂÉïÂÉöÂÉßÂÑÄÂÑíÂÑüÂÖÅÂÖÖÂÖãÂÖçÂÖ∏ÂÖºÂÜíÂÜóÂÜ†ÂÜ¥ÂÜ∂ÂáÜÂáåÂáúÂáùÂá°Âá™Âá±Âá∂Âá∏ÂáπÂàÄÂàÉÂààÂàëÂâäÂâñÂâõÂâ£Ââ§Ââ∞ÂâµÂäüÂä£Âä±ÂäæÂãÅÂãÖÂãòÂãßÂã≤Âã∫ÂåÅÂå†Âå°ÂåøÂçáÂçëÂçìÂçöÂçØÂç≥Âç¥Âç∏ÂéÑÂéòÂé≥ÂèàÂèäÂèôÂè°Âè•Âè™Âè∂Âè∏ÂêâÂêéÂêèÂêêÂêüÂëÇÂëàÂëâÂìÄÂìâÂì≤ÂîÑÂîÜÂîáÂîØÂî±ÂïÑÂïìÂñÑÂñöÂñùÂñ™Âñ¨Âó£ÂòÜÂòâÂò±Âô®Âô¥ÂöáÂõöÂúèÂú≠ÂùëÂù™ÂûÇÂû£Âü∑ÂüπÂü∫Â†ÄÂ†ÖÂ†ïÂ†§Â†™Â°ÄÂ°ÅÂ°äÂ°ëÂ°öÂ°æÂ¢ìÂ¢úÂ¢®Â¢≥Â¢æÂ£ÅÂ£áÂ£äÂ£åÂ£´Â£ÆÂ£±Â•áÂ•àÂ•âÂ•éÂ•èÂ•ëÂ•îÂ•®Â•™Â•ÆÂ•¥Â¶ÇÂ¶ÉÂ¶ÑÂ¶äÂ¶ôÂ¶•Â¶®Âß´ÂßªÂßøÂ®ÅÂ®†Â®ØÂ©ÜÂ©øÂ™íÂ™õÂ´ÅÂ´åÂ´°Â¨âÂ¨¢Â≠îÂ≠üÂ≠§ÂÆèÂÆóÂÆôÂÆúÂÆ£ÂÆ•ÂÆÆÂÆ∞ÂÆ¥ÂÆµÂØÇÂØÖÂØÜÂØõÂØ°ÂØßÂØ©ÂØÆÂØ∏Â∞ÑÂ∞âÂ∞ãÂ∞öÂ∞≠Â∞±Â∞∫Â∞ºÂ∞ΩÂ∞æÂ∞øÂ±àÂ±ïÂ±ûÂ±•Â±ØÂ≤êÂ≤¨Â≤≥Â≥†Â≥°Â¥áÂ¥éÂ¥öÂ¥©ÂµêÂµ©ÂµØÂ∂∫Â∑åÂ∑°Â∑£Â∑ßÂ∑±Â∑≥Â∑¥Â∑ΩÂ∏ÜÂ∏ùÂ∏•Â∏≥ÂπïÂπ£ÂππÂπªÂπΩÂ∫ÑÂ∫èÂ∫∂Â∫∑Â∫∏ÂªÉÂªâÂªäÂª∑ÂºÅÂºäÂºêÂºìÂºîÂºòÂº•Âº¶ÂºßÂºµÂºæÂΩóÂΩ¶ÂΩ©ÂΩ™ÂΩ´ÂΩ¨ÂΩ∞ÂΩ±ÂæÄÂæÅÂæÑÂæêÂæìÂæ™ÂæÆÂæ≥Âæ¥ÂæπÂøåÂøçÂøóÂøúÂø†ÊÄúÊÄ†ÊÄ™ÊÅíÊÅïÊÅ®ÊÅ©ÊÅ≠ÊÅµÊÇåÊÇîÊÇüÊÇ†ÊÇ¶ÊÇºÊÉáÊÉëÊÉúÊÉüÊÉ£ÊÉ®ÊÉ∞ÊÑÅÊÑâÊÑöÊÖàÊÖãÊÖéÊÖïÊÖ¢ÊÖßÊÖ®ÊÖÆÊÖ∞ÊÖ∂ÊÜÇÊÜ§ÊÜßÊÜ©ÊÜ≤ÊÜ∂ÊÜæÊááÊáêÊá≤Êá∏ÊàëÊàíÊàØÊàøÊâáÊââÊâ±Êâ∂ÊâπÊäÑÊääÊäëÊäóÊäûÊä´ÊäµÊäπÊäΩÊãçÊãêÊãíÊãìÊãòÊãôÊã†Êã°Êã¨Êã≥Êã∑ÊåëÊåôÊåØÊåøÊçÆÊç∑Êç∫ÊéàÊéåÊéíÊéßÊé®Êé™Êé≤ÊèèÊèêÊèöÊè°ÊèÆÊè¥Êè∫Êê¨Êê≠Êê∫ÊêæÊëÇÊëòÊë©ÊíÉÊí§ÊíÆÊí≤ÊìÅÊìçÊì¶Êì¨ÊîªÊïÖÊïèÊïëÊï¢Êï¶Êï¥ÊïµÊï∑ÊñâÊñéÊñêÊñóÊñúÊñ§Êñ•ÊñºÊñΩÊóãÊóóÊó¢Êó¶Êó®Êó¨Êó≠Êó∫ÊòÇÊòÜÊòåÊò≠ÊòØÊò¥ÊôÉÊôãÊôèÊôüÊô®Êô∂Êô∫ÊöÅÊöâÊöëÊöñÊö¢Êö¶Êö´ÊõôÊúãÊúîÊúïÊúóÊú±Êú¥ÊúΩÊùâÊùéÊùèÊùúÊù°ÊùæÊûêÊû†Êû¢Êû∂ÊüÑÊüäÊüêÊüìÊüöÊü≥ÊüæÊ†ìÊ†óÊ†ûÊ†™Ê†∏Ê†ΩÊ°ÇÊ°ÉÊ°àÊ°êÊ°ëÊ°úÊ°üÊ¢ÖÊ¢ìÊ¢¢Ê¢ßÊ¢®Ê£ÑÊ£ãÊ£öÊ£üÊ£∫Ê§ãÊ§éÊ§úÊ§∞Ê§øÊ•äÊ•ìÊ•†Ê•ºÊ¶ÇÊ¶õÊßôÊßªÊßΩÊ®ôÊ®°Ê®πÊ®∫Ê©òÊ™ÄÊ¨ÑÊ¨£Ê¨ΩÊ¨æÊ≠ìÊÆâÊÆäÊÆñÊÆ¥ÊÆªÊØÖÊØ¨Ê∞èÊ±ÅÊ±êÊ±üÊ±∞Ê±ΩÊ≤ñÊ≤ôÊ≤°Ê≤¢Ê≤ºÊ≤øÊ≥åÊ≥°Ê≥£Ê≥∞Ê¥ûÊ¥•Ê¥™Ê¥≤Ê¥µÊ¥∏Ê¥æÊµÑÊµúÊµ¶Êµ©Êµ™Êµ∏Ê∂ØÊ∑ëÊ∑°Ê∑≥Ê∑ªÊ∏áÊ∏âÊ∏ãÊ∏ìÊ∏öÊ∏•Ê∏¶ÊπßÊ∫êÊ∫ùÊªÖÊªâÊªëÊªùÊªûÊºÇÊºÜÊºèÊº†Êº´Êº¨Êº±Êº∏ÊΩîÊΩúÊΩüÊΩ§ÊΩÆÊæÑÊæ™ÊøÄÊøÅÊø´ÁÄ¨ÁÅΩÁÇâÁÇäÁÇéÁÇ∫ÁÉàÁÑ¶ÁÖ©ÁÖÆÁÜäÁÜôÁÜüÁáéÁá¶ÁáøÁàµÁàΩÁàæÁâßÁâ≤Áä†ÁãÇÁã©Áã¨Áã≠ÁåõÁåüÁå™ÁåÆÁå∂ÁåøÁçÑÁç£Áç≤ÁéÑÁéáÁéñÁé≤Áè†Áè≠ÁêâÁê¢Áê≥Áê¥ÁëöÁëõÁëûÁë†Áë≥Áë∂ÁíÉÁí∞ÁîöÁî´Áî≤ÁïîÁïùÁï∞ÁñéÁñ´ÁñæÁóáÁóòÁó¢Áó¥ÁôíÁôñÁöáÁöêÁöìÁõÜÁõäÁõõÁõüÁõ£Áõ§Áõ≤ÁõæÁúâÁúãÁú∏Áú∫ÁúºÁù°Áù£Áù¶Áû¨Áû≠Áû≥ÁüõÁü¢ÁüØÁ†ïÁ†≤Á°ùÁ°´Á¢ÅÁ¢ëÁ¢ßÁ¢©Á£ÅÁ£ØÁ§ÅÁ§éÁ•âÁ•êÁ••Á•®Á¶ÑÁ¶ÖÁ¶çÁ¶éÁßÄÁßòÁ•ñÁß¶Áß©Áß∞Á®ÄÁ®îÁ®öÁ®úÁ®≤Á®ºÁ®øÁ©ÄÁ©ÇÁ©èÁ©£Á©´Á©¥Á™ÉÁ™íÁ™ÆÁ™ØÁ´úÁ´£Á´ØÁ¨ôÁ¨õÁ¨¨Á¨πÁ≠ãÁ≠ñÁÆáÁØÄÁØÑÁØ§Á∞øÁ≤ãÁ≤óÁ≤òÁ≤õÁ≥ñÁ≥ßÁ≥ªÁ≥æÁ¥ÄÁ¥ãÁ¥çÁ¥óÁ¥òÁ¥öÁ¥õÁ¥†Á¥°Á¥¢Á¥´Á¥¨Á¥ØÁ¥≥Á¥∫ÁµÉÁµêÁµûÁµ¢Áµ±ÁµπÁ∂ôÁ∂úÁ∂≠Á∂±Á∂≤Á∂∏Á∂∫Á∂æÁ∑äÁ∑ãÁ∑†Á∑©Á∑ØÁ∏ÅÁ∏ÑÁ∏õÁ∏¶Á∏´Á∏ÆÁπÅÁπäÁπîÁπïÁπ≠Áπ∞ÁΩ∞ÁΩ∑ÁæÖÁæäÁæ©ÁøÅÁøîÁø†ÁøªÁøºËÄÄËÄêËÄóËÄ∂ËÅñËÅ°ËÅ¥ËÇáËÇñËÇùËÇ¢ËÇ•ËÇ™ËÇ∫ËÉÜËÉéËÉûËÉ°ËÉ§ËÉ¥ËÑÖËÑàËÑöËÑ©ËÑ±ËÑπËÖêËÖ∏ËÜúËÜ®Ëá®Ëá≠Ëá≥Ëá¥ËààËàåËàéËàóËàúËà∂ËâáËâ¶Ëâ∂ËäãËäôËäùËä≥ËäπËäΩËãëËãóËåÇËåÑËåÖËåâËåéËåúËçòËéâËéûËèäËèåËèñËè´ËèØËêåËê©Ëë¨ËëµËíîËíºËìÑËìâËìÆËî¶ËïâËïóËñ¶Ëñ™Ëñ´ËóçËó§Ëó©ËóªËò≠ËôéËôêËôöËôúËôûËôπËöäËöïËõáËõçËõÆËù∂ËûçË°ÜË°óË°õË°ùË°°Ë°∞Ë°∑Ë°øË¢àË£ÅË£ÇË£ïË£üË£∏Ë£ΩË§êË§íË•üË•≤Ë¶ÜË¶áË¶ñË¶ßË®ÇË®éË®óË®üË®üË®¥Ë®∫Ë®ºË©êË©îË©ïË©†Ë©¢Ë©©Ë©≤Ë©≥Ë™áË™âË™ìË™ïË™òË™†Ë™ºË´ÑË´ãË´íË´≠Ë´ÆË´æË¨ÄË¨ÅË¨ÑË¨ôË¨ùË¨°Ë¨πË≠úË≠≤Ë≠∑Ë±ÜË±öË±™Ë≤ûË≤¢Ë≤´Ë≤¥Ë≥ÄË≥ÉË≥ÑË≥äË≥ìË≥úË≥†Ë≥¶Ë≥ºËµ¶Ëµ≥Ëµ¥Ë∂£Ë∑ùË∑≥Ë∑µË∏èË∫çËªåËª∏ËºÉËºâËºîËºùËº©ËΩÑËæ∞Ëæ±ËøÖËø™Ëø´Ëø≠ÈÄèÈÄêÈÄìÈÄùÈÄÆÈÄ∏ÈÅÇÈÅáÈÅçÈÅ£ÈÅ•ÈÅ≠ÈÅÆÈÅµÈÅ∑ÈÅ∫ÈÅºÈÅøÈÇÑÈÇëÈÇ£ÈÇ¶ÈÇ™ÈÇ∏ÈÉÅÈÉéÈÉ°ÈÉ≠ÈÉ∑ÈÖâÈÖåÈÖîÈÖ¢ÈÖ™ÈÖ¨ÈÖµÈÖ∑ÈÖ∏ÈÜúÈÜ∏ÈááÈáàÈá£Èà¥ÈâõÈâ¢ÈäÉÈäëÈäòÈä≠Èã≥ÈãºÈåòÈå†Èå¶Èå¨ÈåØÈçõÈéåÈéñÈéÆÈè°ÈêòÈëëÈñëÈñ£Èñ•Èñ≤ÈóòÈòªÈòøÈôÑÈôõÈô£Èô•Èô™Èô∞Èô≥ÈôµÈô∂ÈöÜÈöäÈöèÈöîÈöúÈö†Èö£Èö∑ÈöºÈõÑÈõÖÈõåÈõõÈõ¢Èõ∞Èõ∑ÈúÄÈúäÈúúÈúûÈúßÈú≤ÈùñÈû†ÈüªÈüøÈ†ÖÈ†àÈ†åÈ†ëÈ†íÈ†ªÈ°ïÈ°ßÈ¢ØÈ£¢È£ºÈ£ΩÈ£æÈ§äÈ§ìÈ¶®ÈßÑÈßÜÈßíÈßøÈ®éÈ®íÈ®∞ÊõΩÈ´ÑÈ¨ºÈ≠ÅÈ≠ÇÈ≠ÖÈ≠îÈÆéÈÆÆÈØâÈØõÈØ®È≥©È≥≥È¥ªÈµ¨È∂èÈ∂¥È∑πÈπøÈ∫óÈ∫üÈ∫ªÈ∫øÈªéÈªôÈªõÈºì").split("")
 };
 const JLPT_COLOR = {
  'jlpt-n5': 'var(--n5)',
  'jlpt-n4': 'var(--n4)',
  'jlpt-n3': 'var(--n3)',
  'jlpt-n2': 'var(--n2)',
  'jlpt-n1': 'var(--n1)'
 };
 const JLPT_BORDER = {
  'jlpt-n5': 'var(--wn5)',
  'jlpt-n4': 'var(--wn4)',
  'jlpt-n3': 'var(--wn3)',
  'jlpt-n2': 'var(--wn2)',
  'jlpt-n1': 'var(--wn1)'
 };

 const $ = id => document.getElementById(id);
 function el(tag, cls) {
  const d = document.createElement(tag);
  if (cls) d.className = cls;
  return d;
 }

 function renderManual(level) {
  const grid = $('kanjiGrid');
  grid.innerHTML = '';
  const data = JLPT[level] || [];
  if (!data.length) {
   grid.innerHTML = '<div class="muted">Tidak ada kanji</div>';
   return;
  }
  data.forEach(ch => {
   const card = el('div', 'kanji-card');
   card.innerHTML = `<div class="kanji-char">${ch}</div>`;
   card.style.background = JLPT_COLOR[level];
   card.style.borderColor = JLPT_BORDER[level];
   card.onclick = () => selectKanji(ch, level);
   grid.appendChild(card);
  });
 }
 
 // small helper to avoid inserting raw HTML from API into the page
 function escapeHtml(str) {
  if (!str) return '';
  return String(str)
   .replace(/&/g, '&amp;')
   .replace(/</g, '&lt;')
   .replace(/>/g, '&gt;')
   .replace(/"/g, '&quot;')
   .replace(/'/g, '&#39;');
 }
 
 // --- 2. NEW ANIMATION FUNCTION (Extracted from selectKanji) ---
 async function animateKanjiStroke(k) {
  const strokeBox = $('strokeBox');
  if (strokeBox) strokeBox.innerHTML = '<div class="muted loading">Memuat animasi goresan‚Ä¶</div>';

  try {
   const code = k.codePointAt(0).toString(16).padStart(5, '0');
   const svgUrl = `https://raw.githubusercontent.com/KanjiVG/kanjivg/master/kanji/${code}.svg`;
   const sres = await fetch(svgUrl);

   if (!sres.ok) {
    if (strokeBox) strokeBox.innerHTML = '<div class="muted">Tidak ada data stroke KanjiVG.</div>';
    return;
   }
   
   let svgText = await sres.text();

   // sanitize: remove xml/doctypes and stray ]]> etc.
   svgText = svgText
    .replace(/<\?xml[\s\S]*?\?>/g, '')
    .replace(/<!DOCTYPE[\s\S]*?>/g, '')
    .replace(/\]\]>/g, '')
    .trim();

   if (!/\<svg[\s\S]*?\>/.test(svgText)) {
    if (strokeBox) strokeBox.innerHTML = '<div class="muted">SVG tidak valid.</div>';
    return;
   }

   let doc;
   try {
    doc = (new DOMParser()).parseFromString(svgText, 'image/svg+xml');
    if (doc.getElementsByTagName('parsererror').length) throw new Error('parsererror');
   } catch (err) {
    const tmp = document.createElement('div');
    tmp.innerHTML = svgText;
    const svgElem = tmp.querySelector('svg');
    if (!svgElem) {
     if (strokeBox) strokeBox.innerHTML = '<div class="muted">SVG tidak dapat diurai.</div>';
     return;
    }
    doc = document.implementation.createDocument('', '', null);
    const imported = document.importNode(svgElem, true);
    doc.appendChild(imported);
   }

   const svg = doc.querySelector('svg');
   if (!svg) {
    if (strokeBox) strokeBox.innerHTML = '<div class="muted">SVG tidak valid.</div>';
    return;
   }

   svg.querySelectorAll('text').forEach(n=>n.remove());
   svg.removeAttribute('width');
   svg.removeAttribute('height');
   svg.setAttribute('preserveAspectRatio', 'xMidYMid meet');

   const container = document.createElement('div');
   container.style.cssText = 'display:flex; justify-content:center; align-items:center; width:100%; pointer-events:none;';

   const styleEl = document.createElement('style');
   styleEl.textContent = `@keyframes k_draw { to { stroke-dashoffset: 0; } }`;
   container.appendChild(styleEl);

   const importedSvg = document.importNode(svg, true);
   importedSvg.style.cssText = 'width:100%; max-width:240px; height:auto; display:block;';

   importedSvg.querySelectorAll('*').forEach(n=>{
    if (n.hasAttribute && n.hasAttribute('fill')) {
     n.removeAttribute('fill');
    }
   });

   const paths = Array.from(importedSvg.querySelectorAll('path'));
   if (!paths.length) {
    if (strokeBox) strokeBox.innerHTML = '<div class="muted">Tidak ada path di SVG.</div>';
    return;
   }

   container.appendChild(importedSvg);
   strokeBox.innerHTML = '';
   strokeBox.appendChild(container);

   // After SVG is in DOM, compute lengths and set animation per path
   requestAnimationFrame(()=> {
    const domPaths = strokeBox.querySelectorAll('path');
    domPaths.forEach((p, i) => {
     try {
      // *** CRITICAL FOR REPLAY ***
      p.style.animation = 'none'; // Clear previous animation
      void p.offsetWidth; // Force a DOM reflow (required for re-running CSS animation)

      // compute length
      const len = p.getTotalLength();
      p.style.stroke = '#ffffff';
      p.style.strokeWidth = '6';
      p.style.fill = 'none';
      p.style.strokeLinecap = 'round';
      p.style.strokeLinejoin = 'round';
      p.style.strokeDasharray = `${len}`;
      p.style.strokeDashoffset = `${len}`; // Start position for animation
      
      const delay = (i * 0.9); // stagger slightly
      const duration = Math.max(0.9, Math.min(1.4, len / 320)); // adaptive
      p.style.animation = `k_draw ${duration}s cubic-bezier(.2,.8,.2,1) ${delay}s forwards`;
     } catch (err) {
      // fallback small animation if getTotalLength fails
      p.style.stroke = '#ffffff';
      p.style.strokeWidth = '6';
      p.style.fill = 'none';
      p.style.animation = `k_draw 1.5s ease ${i*1.5}s forwards`;
     }
    });
   });
  } catch (err) {
   console.warn('SVG anim error', err);
   if (strokeBox) strokeBox.innerHTML = '<div class="muted">Tidak ada animasi goresan.</div>';
  }
 }

 async function selectKanji(k, level = null) {
  // --- 3. Update Global Kanji State ---
  currentKanji = k;
  
  // shorthand helpers (if you used different ones, adapt)
  const $ = id => document.getElementById(id);
  const el = (tag, cls) => { const d = document.createElement(tag); if (cls) d.className = cls; return d; };

  // Reset UI
  if ($('kanjiLarge')) $('kanjiLarge').textContent = k;
  if ($('kanjiTitle')) $('kanjiTitle').textContent = k;
  if ($('romaread')) $('romaread').textContent = '-';
  if ($('meaningsEng')) $('meaningsEng').textContent = 'Sedang memuat‚Ä¶';
  if ($('meaningsId')) $('meaningsId').textContent = 'Menerjemahkan‚Ä¶';
  if ($('kunRead')) $('kunRead').textContent = '-';
  if ($('onRead')) $('onRead').textContent = '-';
  if ($('radicals')) $('radicals').innerHTML = '-';
  if ($('wordsList')) $('wordsList').innerHTML = '<div class="muted loading">Memuat kata contoh‚Ä¶</div>';
  // **REMOVED** the initial 'Memuat animasi goresan...' here, it's now in animateKanjiStroke

  // JLPT badge color
  if ($('jlptBadge')) {
   $('jlptBadge').style.background = level ? JLPT_BORDER[level] : '#222';
  }

  // --- Call the dedicated animation function ---
  animateKanjiStroke(k);

  try {
   // === Kanji Info ===
   const res = await fetch(`${API_ROOT}/kanji/${encodeURIComponent(k)}`);
   const data = await res.json();

   const eng = (data.meanings || []).join(', ');
   if ($('romaread')) $('romaread').textContent = (data.name_readings || []).join('„ÄÅ') || '-';
   if ($('meaningsEng')) $('meaningsEng').textContent = eng || '-';
   if ($('kunRead')) $('kunRead').textContent = (data.kun_readings || []).join('„ÄÅ') || '-';
   if ($('onRead')) $('onRead').textContent = (data.on_readings || []).join('„ÄÅ') || '-';
   if ($('strokeBadge')) $('strokeBadge').textContent = 'Goresan: ' + (data.stroke_count || '-');
   if ($('jlptBadge')) $('jlptBadge').textContent = 'JLPT-N' + (data.jlpt ||'0 '+ (level ? level.toUpperCase().replace('JLPT-', '') : ''));
   if ($('jlptBadge')) $('jlptBadge').style.background = JLPT_BORDER[data.jlpt];
   
   // Translation

   async function translateToIndonesian(text) {
    if (!text || text === '-') return '-';
    try {
        const res = await fetch(`${MYMEMORY_BASE}${encodeURIComponent(text)}${LANG_PAIR}`);
        if (!res.ok) {
            // Handle HTTP errors (e.g., 400, 500)
            return 'Terjemah GAGAL: (Error HTTP ' + res.status + ')';
        }
        
        const data = await res.json();
        
        if (data && data.responseData && data.responseData.translatedText) {
            let translated = data.responseData.translatedText;
            // Check if translation is valid and not just an echo of the input
            if (translated && translated.toLowerCase().trim() !== text.toLowerCase().trim()) {
                return translated;
            }
        }
        
        // If API succeeded but returned bad/empty data
        return `Terjemah GAGAL: [Tidak ada hasil]`;

    } catch (err) {
        // Catch network errors (CORS, offline, etc.) or JSON parsing errors
        console.error('Translation error:', err);
        return `Terjemah GAGAL: [Network/Parsing Error]`;
    }
}
if ($('meaningsId')) {
    const idTranslation = await translateToIndonesian(eng);
    $('meaningsId').textContent = idTranslation;
}


   // üü¢ RADICALS
   if ($('radicals')) {
    const radBox = $('radicals');
    if (data.radical && data.radical.character) {
     radBox.innerHTML = `
      <div class="rad main">${data.radical.character}</div>
      <div class="rad-meaning">${data.radical.meaning || ''}</div>
     `;
    } else {
     radBox.innerHTML = '<div class="muted">Radikal tidak tersedia.</div>';
    }
   }

   // === WORD EXAMPLES (kanjiapi) ===
   let wdata = [];
   try {
    const wres = await fetch(`https://kanjiapi.dev/v1/words/${encodeURIComponent(k)}`);
    if (wres.ok) wdata = (await wres.json()) || [];
   } catch (e) { console.warn('Gagal memuat kata dari kanjiapi:', e); }

   if ($('wordsList')) {
    $('wordsList').innerHTML = '';
    if (!wdata.length) {
     $('wordsList').innerHTML = '<div class="muted">Tidak ada contoh kata.</div>';
    } else {
     wdata.slice(0, 6).forEach(entry => {
      let variant = entry.variants?.[0] || {};
      let meanings = entry.meanings?.[0] || {};
      let word = variant.written || entry.slug || '';
      let reading = variant.pronounced || '';
      let gloss = (meanings.glosses || []).slice(0, 2).join('; ') || '';

      let d = el('div', 'word');
      d.innerHTML = `
       <div style="font-weight:700">
        ${word} <span style="font-size:12px;color:var(--muted)">${reading}</span>
       </div>
       <div style="font-size:13px;color:var(--muted)">${gloss}</div>
      `;
      $('wordsList').appendChild(d);
     });
    }
   }
  } catch (err) {
   console.error(err);
   if ($('meaningsEng')) $('meaningsEng').textContent = 'Error';
   if ($('strokeBox')) $('strokeBox').innerHTML = '<div class="muted">Gagal memuat data.</div>';
  }
 }

 // --- 4. NEW REPLAY FUNCTION ---
 function replayKanjiStroke() {
  if (!currentKanji) {
   alert('Pilih kanji terlebih dahulu.');
   return;
  }
  // Call the dedicated animation function with the currently selected kanji
  animateKanjiStroke(currentKanji);
 }

 let censorEnabled = false; // start with censor ON

$('toggleCensor').onclick = () => {
    censorEnabled = !censorEnabled;
    $('toggleCensor').textContent = censorEnabled ? 'ON' : 'OFF';

    // toggle fade+blur with animation
    document.querySelectorAll('.censorable').forEach(el => {
      if (censorEnabled) {
        el.classList.add('censored');
      } else {
        el.classList.remove('censored');
      }
    });

    document.querySelectorAll('.censorable1').forEach(el => {
      if (censorEnabled) {
        el.classList.add('censored1');
      } else {
        el.classList.remove('censored1');
      }
    });
  };
 
 
 // Attach event listeners
 document.addEventListener('DOMContentLoaded', () => {
  // --- 5. Attach Replay Button Event ---
  const replayButton = $('replayStroke');
  if (replayButton) {
   replayButton.addEventListener('click', replayKanjiStroke);
  }

  $('loadList').addEventListener('click', () => renderManual($('listSelect').value));
  $('searchInput').addEventListener('keydown', e => {
   if (e.key === 'Enter') selectKanji(e.target.value[0] || '', null);
  });
  $('randomBtn').addEventListener('click', () => {
   const cards = document.querySelectorAll('.kanji-card');
   if (cards.length) {
    const r = cards[Math.floor(Math.random() * cards.length)];
    r.click();
    r.scrollIntoView({ behavior: 'smooth', block: 'center' });
   }
  });
  
  // Initial load
  renderManual('jlpt-n5');
  setTimeout(() => {
   const f = document.querySelector('.kanji-card');
   if (f) f.click();
  }, 300);
 });
</script>

</body>
</html>
